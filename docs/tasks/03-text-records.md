# Task 03: テキストレコード生成（無圧縮）

## 概要
統合されたHTMLを4096バイトのブロックに分割し、無圧縮のテキストレコードとして生成する。Phase 1のMVPでは無圧縮を採用し、PalmDoc圧縮はPhase 2（Task 10）で実装する。

## 関連
- **spec.md参照**: §4.5
- **依存タスク**: Task 01（テキストレコード数をMOBIヘッダーに記録）
- **GitHub Issue**: #7

## 背景
AZW3のテキストコンテンツは、統合されたHTML全体をバイト列化し、4096バイトごとに分割してPDBレコードに格納する。MVPでは無圧縮（compression type = 1）で実装し、基本的な動作確認を優先する。

## 実装場所
- 新規ファイル: `internal/mobi/text_record.go`
- テストファイル: `internal/mobi/text_record_test.go`

## 要件

### テキストレコードの仕様
- 入力: 統合済みHTMLのUTF-8バイト列
- 分割単位: 4096バイト（圧縮前の最大サイズ）
- 最後のレコード: 4096バイト未満でも可
- 圧縮タイプ: MVPでは 1（無圧縮）をPalmDOCヘッダーに設定。Task 10でPalmDoc圧縮を導入した場合は 2 に切り替える

### PalmDOCヘッダーとの連携
- テキスト長: HTMLバイト列の総バイト数
- テキストレコード数: ceil(テキスト長 / 4096)
- 最大レコードサイズ: 4096

## データ構造

### TextRecordGenerator
- RecordSize: int — 最大レコードサイズ（4096固定）
- 入力のHTMLバイト列を受け取り、[][]byte のレコードスライスを返す

## 実装ガイドライン
- HTMLバイト列を4096バイトで単純に分割
- UTF-8文字境界を考慮しない（バイト単位で分割）
- 将来のPalmDoc圧縮対応のため、圧縮インターフェースを考慮した設計
- `converter.HTMLBuilder.Build()` の出力をバイト列化して入力とする
- 圧縮の有無はパイプライン側から注入できるようにする（Task 10で切替）

## テスト方針
- 空のHTML → 0レコード
- 4096バイト未満 → 1レコード
- ちょうど4096バイト → 1レコード
- 4097バイト → 2レコード（4096 + 1）
- 大きなHTML（例: 12288バイト）→ 3レコード
- レコード数がPalmDOCヘッダーの値と一致すること

## 完了条件
- [ ] テキストレコード分割関数
- [ ] レコード数とテキスト長の計算
- [ ] 圧縮インターフェースの定義（無圧縮実装）
- [ ] 全テストがパス
