# Task 02: EXTHレコード生成

## 概要
AZW3ファイルのメタデータを格納するEXTHレコードを生成する。MOBIヘッダーの後、Full Nameの前に配置される拡張メタデータブロック。

## 関連
- **spec.md参照**: §4.4
- **依存タスク**: Task 01（MOBIヘッダー — レコード0内でEXTHの配置位置を決定）
- **GitHub Issue**: —

## 背景
EXTHレコードはMOBIヘッダーの拡張として、著者名、タイトル、出版社などのメタデータを格納する。KF8-only形式でもKindle Paperwhite実機互換のため、タイプ121（KF8境界オフセット）と125（レコード数）は必須。

## 実装場所
- 新規ファイル: `internal/mobi/exth.go`
- テストファイル: `internal/mobi/exth_test.go`

## 要件

### EXTHヘッダー構造（12バイト）
- 識別子: "EXTH" (0x45585448) — 4バイト
- ヘッダー長: 12 + 全レコードの合計サイズ — 4バイト
- レコード数: N — 4バイト

### 各レコードの構造
- レコードタイプ: 4バイト
- レコード長: 4バイト（この8バイト + データ長）
- データ: 可変長

### 主要レコードタイプ

| タイプ | 内容 | データ形式 |
|-------|------|----------|
| 100 | 著者 | UTF-8文字列 |
| 101 | 出版社 | UTF-8文字列 |
| 103 | 説明 | UTF-8文字列 |
| 104 | ISBN | UTF-8文字列 |
| 105 | サブジェクト | UTF-8文字列 |
| 106 | 出版日 | YYYY-MM-DD |
| 109 | 権利 | UTF-8文字列 |
| 121 | KF8境界オフセット | 4バイト整数 |
| 125 | レコード数 | 4バイト整数 |
| 131 | カバーオフセット | 4バイト整数 |
| 503 | 更新タイトル | UTF-8文字列 |
| 524 | 言語 | 言語コード文字列 |

### アライメント
- EXTH全体を4バイト境界にパディング

## データ構造

### EXTHRecord 構造体
- Type: uint32 — レコードタイプ
- Data: []byte — レコードデータ

### EXTHHeader 構造体
- Records: []EXTHRecord — レコード配列

## 実装ガイドライン
- 文字列データはUTF-8バイト列として格納
- 整数データはビッグエンディアン4バイトで格納
- タイプ121（KF8境界）はKF8-onlyでも省略しない。値は **KF8セクション開始レコード番号**（MOBI7を含まない場合は最初のKF8テキストレコード番号＝通常1）
- タイプ125（レコード数）はKF8-onlyでも省略しない。値は **最終的なPDBレコード総数**
- `epub.Metadata` からEXTHレコードへの変換ヘルパー関数を提供
- EXTHバイト列のサイズを返す関数（MOBIヘッダーのFull Name Offset計算に必要）
- 121/125はレコード配置確定後に値が決まるため、**後から更新できるAPI**または組み立てフェーズ（Task 06）での差し替えを許容する

## テスト方針
- EXTH識別子が "EXTH" であること
- ヘッダー長が正しく計算されること
- 各レコードタイプのデータが正しくエンコードされること
- 4バイトアライメントが適用されること
- KF8必須レコード（121, 125）が含まれること
- 空のメタデータでも最低限のレコードが生成されること

## 完了条件
- [ ] EXTH構造体とレコード追加関数
- [ ] バイナリシリアライズ関数（4バイトアライメント含む）
- [ ] `epub.Metadata` → EXTH変換関数
- [ ] KF8必須レコード（121, 125）の自動追加
- [ ] EXTHサイズ計算関数
- [ ] 全テストがパス
